<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>AppFog &mdash; Documentation RabbitMQ</title> 

		<link rel="stylesheet" href="http://appfog.com/css/style.css">
		<link href="/css/prettify.css" type="text/css" rel="stylesheet" />
		<link href="/css/table.css" rel="stylesheet">
		<link href="/css/docs.css" rel="stylesheet">
		<!-- typekit -->
		<script type="text/javascript" src="http://use.typekit.com/abw3xjt.js"></script>
		<script type="text/javascript">try{Typekit.load();}catch(e){}</script>
				
		<!-- css -->

		<!-- modernizr -->
		<script src="http://appfog.com/js/libs/modernizr-2.5.3.min.js"></script>

		<script type="text/javascript" src="/js/google-code-prettify/prettify.js"></script>
		<script type="text/javascript" src="/js/jquery.js"></script>
		<script type="text/javascript" src="/js/bootstrap.js"></script>

		<!--  -->
		<link rel="icon" type="image/png" href="http://appfog.com/favicon.ico" />
		
		<script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-16856502-8']);
      _gaq.push(['_setDomainName', '.appfog.com']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
		
	</head>
	<body id="blog" onload="prettyPrint()">
	<div id="header">
		<div class="container">
			<a href="http://appfog.com/" id="app_fog"><img src="http://appfog.com/img/app-fog.png" width="189" height="47" alt="App Fog"></a>
			<ul id="main_nav">
				<li id="nproducts">
					<a href="#" title="Products" class="parent"><span>Products</span></a>
					<ul>
						<li><a href="http://appfog.com/products/appfog">AppFog</a></li>
						<li><a href="http://appfog.com/products/phpfog">PHP Fog</a></li>
					</ul>
				</li>
				<li id="npricing">
					<a href="#" title="Pricing" class="parent"><span>Pricing</span></a>
					<ul>
						<li><a href="https://console.appfog.com/pricing">AppFog</a></li>
						<li><a href="http://appfog.com/products/phpfog/pricing/">PhpFog</a></li>
					</ul>
				</li>
				<li id="nshowcase"><a href="http://appfog.com/showcase/" title="Showcase">Showcase</a></li>
				<li id="nabout"><a href="http://appfog.com/about/" title="About">About</a></li>
				<li id="nsupport"><a href="http://appfog.com/support/" title="Support">Support</a></li>
				<li id="nblog"><a href="http://blog.appfog.com/" title="Blog">Blog</a></li>

				<li id="nlogin">
						  <a href="#" title="Log In" class="btn gray">Log In <i class="icon-chevron-down"></i></a>
						  <form id="log_in_form" class="dropdown">
							<div class="container">
							  <!-- <div class="half">
								<div class="radio_btn" id="log_in_product_php_fog">
								  <span>
									<input type="radio" name="products" value="" id="log_in_php_fog" checked>
								  </span>
								  <label for="log_in_php_fog">Php Fog</label>
								</div>
							  </div>
							  <div class="half">
								<div class="radio_btn" id="log_in_product_appfog">
								  <span>
									<input type="radio" name="products" value="" id="log_in_appfog">
								  </span>
								  <label for="log_in_appfog">AppFog</label>
								</div>
								
							  </div>
							</div> -->
										
							<!-- <hr> -->

							<!-- <div class="container appfog">
							  <input type="email" name="email" value="" id="appfog_log_in_email" placeholder="Email" class="text">
							  <input type="password" name="password" value="" id="appfog_log_in_password" placeholder="Password" class="text">
							</div>
							
							<div class="container php_fog">
							  <input type="email" name="email" value="" id="php_fog_log_in_email" placeholder="Email" class="text">
							  <input type="password" name="password" value="" id="php_fog_log_in_password" placeholder="Password" class="text">
							</div> -->
										

										
							<!-- <div class="container">  
							  <div class="half">
								<div class="checkbox">
								  <span class="active">
									<input type="checkbox" name="remember_me" value="" id="log_in_remember_me" checked>
								  </span>
								</div>
								<label for="log_in_remember_me" class="remember_me">Remember Me</label>
							  </div>

							  <div class="half forgot_password">
								<a href="#">Forgot Password?</a>
							  </div>
							</div> -->
										<a href="https://phpfog.com/login" class="btn bright_green submit" style="font-size: 13px;">Log In to PHP Fog</a>
										<hr>
										<a href="https://console.appfog.com/login" class="btn bright_green submit" style="font-size: 13px;">Log In to AppFog</a>
									</form>
								</li>
								<li id="nsignup">
									<a href="#" title="Sign Up" class="btn bright_green">Sign Up <i class="icon-chevron-down"></i></a>
									<form id="sign_up_form" class="dropdown">
							<!-- <div class="container">
							  <div class="half">
								<div class="radio_btn" id="sign_up_product_php_fog">
								  <span>
									<input type="radio" name="products" value="" id="sign_up_php_fog" checked>
								  </span>
								  <label for="sign_up_php_fog">Php Fog</label>
								</div>
							  </div>
							  <div class="half">
								<div class="radio_btn" id="sign_up_product_appfog">
								  <span>
									<input type="radio" name="products" value="" id="sign_up_appfog">
								  </span>
								  <label for="sign_up_appfog">AppFog</label>
								</div>
								
							  </div>
							</div> -->
										
										<!-- <hr>
													
													<div class="container php_fog">
													  <input type="email" name="email" value="" id="sign_up_php_fog_email" placeholder="Email" class="text">
													  <input type="password" name="password" value="" id="sign_up_password" placeholder="Password" class="text">
													  <input type="password" name="password_confirmation" value="" id="sign_up_password_confirmation" placeholder="Password Confirmation" class="text">
													</div>
													
													<div class="container appfog">
													  <input type="email" name="email" value="" id="sign_up_appfog_email" placeholder="Email" class="text">
													</div> -->
										
										<a href="https://phpfog.com/signup" class="btn bright_green submit" style="font-size: 13px;">Register for PHP Fog</a>
										<hr>
										<a href="http://appfog.com/signup.php" class="btn bright_green submit" style="font-size: 13px;">Register for AppFog</a>
									</form>
								</li>

			</ul>
		</div> 
	</div>
	<div id="main_content">
		<div class='container'>

			
			<div id="top_bar" class="row gray_blue margin_bottom">
				<div class="span12">
					<a href="/"><h1 class="title">AppFog Docs</h1></a>
					<ul id="docs_nav">
						
						<li class="breadcrumb-separator">&raquo;</li>
						<li><a href="/services">Services</a></li>
						
						<li class="breadcrumb-separator">&raquo;</li>
						<li><a href="#">RabbitMQ</a></li>
					</ul>
					<ul id="secondary_nav">
						<li><a href="http://docs.phpfog.com">PHP Fog Docs</a></li>
					</ul>
				</div>

			</div>
			
					


			<div id="content" class="row white">
				<div class="span8 main_content">
					<div class="row entries">
	<div class="span8">
		<div class="row">
			<div class="span8">
				<h1>RabbitMQ</h1>
				<p><a href="http://www.rabbitmq.com/">RabbitMQ</a> is a message broker that provides robust messaging services for your apps.</p>

<ul>
  <li><a href="#rabbitmq-vcap">VCAP_SERVICES Environment Variable</a></li>
  <li><a href="#rabbitmq-node-tutorial">RabbitMQ with Node Tutorial</a></li>
</ul>

<h1 id="rabbitmq-vcap">The VCAP_SERVICES Environment Variable</h1>

<p>When you provision and bind a service to your app, AppFog creates an environment variable called <code>VCAP_SERVICES</code>. For apps that can’t be automatically configured, you can find the information your app needs to connect to the database in this variable.</p>

<p>This variable contains a JSON document with a list of all credentials and connection information for the bound services.</p>

<p>Here’s an example that of the environment variable for an app that has a RabbitMQ service bound to it:</p>

<pre class="prettyprint linenums"><code>{"rabbitmq-2.4":[
    {
        "name":"rabbitmq-example",
        "label":"rabbitmq-2.4",
        "plan":"free",
        "tags":["rabbitmq","rabbitmq-2.4","message-queue","amqp"],
        "credentials":{
            "name":"f5666391-510e-44ba-96cf-12e2d691854f",
            "hostname":"10.7.67.64",
            "host":"10.7.67.64",
            "port":10004,
            "vhost":"v32dc3278e8294672be14eb00083c2a44",
            "username":"u2rOaKWovmj44",
            "user":"u2rOaKWovmj44",
            "password":"pMxGDaMxfvQx4",
            "pass":"pMxGDaMxfvQx4",
            "url":"amqp://u2rOaK:pMxGDaM@10.7.67.64:10004/v32dc327"
        }
    }
]}
</code></pre>

<p>You can use your app’s language-specific facility to call the environment variable.</p>

<p>In Java:</p>

<pre class="prettyprint"><code>java.lang.System.getenv("VCAP_SERVICES")
</code></pre>

<p>In Ruby:</p>

<pre class="prettyprint"><code>ENV['VCAP_SERVICES']
</code></pre>

<p>In Javascript:</p>

<pre class="prettyprint"><code>process.env.VCAP_SERVICES
</code></pre>

<p>In Python:</p>

<pre class="prettyprint"><code>os.getenv("VCAP_SERVICES")
</code></pre>

<p>In PHP:</p>

<pre class="prettyprint"><code>getenv("VCAP_SERVICES")
</code></pre>

<h1 id="rabbitmq-node-tutorial">RabbitMQ with Node Tutorial</h1>

<p>Let’s quickly run through creating a Node.js app that uses RabbitMQ.</p>

<h3 id="create-application-files">Create Application Files</h3>

<p>Create an app directory and change into it:</p>

<pre><code>$ mkdir rabbitmq-node
$ cd rabbitmq-node
</code></pre>

<p>Create the file <code>package.json</code> with the following contents:</p>

<pre class="prettyprint linenums"><code>{
    "name":"node-amqp-demo",
    "version":"0.0.1",
    "dependencies": {
        "amqp":"&gt;= 0.1.0",
        "sanitizer": "*"
    }
}
</code></pre>

<p>This <code>package.json</code> specifies two dependent libraries: <code>amqp</code> for message processing and sanitizer to escape <code>HTML</code> messages.</p>

<p>Install the dependencies, using <code>npm</code>:</p>

<pre><code>$ npm install
</code></pre>

<p>Create <code>app.js</code> with the following code:</p>

<pre class="prettyprint linenums"><code>var http = require('http');
var amqp = require('amqp');
var URL = require('url');
var htmlEscape = require('sanitizer/sanitizer').escape;

function rabbitUrl() {
  if (process.env.VCAP_SERVICES) {
    conf = JSON.parse(process.env.VCAP_SERVICES);
    return conf['rabbitmq-2.4'][0].credentials.url;
  }
  else {
    return "amqp://localhost";
  }
}

var port = process.env.VCAP_APP_PORT || 3000;

var messages = [];

function setup() {

  var exchange = conn.exchange('cf-demo', {'type': 'fanout', durable: false}, function() {

    var queue = conn.queue('', {durable: false, exclusive: true},
    function() {
      queue.subscribe(function(msg) {
        messages.push(htmlEscape(msg.body));
        if (messages.length &gt; 10) {
          messages.shift();
        }
      });
      queue.bind(exchange.name, '');
    });
    queue.on('queueBindOk', function() { httpServer(exchange); });
  });
}

function httpServer(exchange) {
  var serv = http.createServer(function(req, res) {
    var url = URL.parse(req.url);
    if (req.method == 'GET' &amp;&amp; url.pathname == '/env') {
      printEnv(res);
    }
    else if (req.method == 'GET' &amp;&amp; url.pathname == '/') {
      res.statusCode = 200;
      openHtml(res);
      writeForm(res);
      writeMessages(res);
      closeHtml(res);
    }
    else if (req.method == 'POST' &amp;&amp; url.pathname == '/') {
      chunks = '';
      req.on('data', function(chunk) { chunks += chunk; });
      req.on('end', function() {
        msg = unescapeFormData(chunks.split('=')[1]);
        exchange.publish('', {body: msg});
        res.statusCode = 303;
        res.setHeader('Location', '/');
        res.end();
      });
    }
    else {
      res.statusCode = 404;
      res.end("This is not the page you were looking for.");
    }
  });
  serv.listen(port);
}

console.log("Starting ... AMQP URL: " + rabbitUrl());
var conn = amqp.createConnection({url: rabbitUrl()});
conn.on('ready', setup);

// ---- helpers

function openHtml(res) {
  res.write("&lt;html&gt;&lt;head&gt;&lt;title&gt;Node.js / RabbitMQ demo&lt;/title&gt;&lt;/head&gt;&lt;body&gt;");
}

function closeHtml(res) {
  res.end("&lt;/body&gt;&lt;/html&gt;");
}

function writeMessages(res) {
  res.write('&lt;h2&gt;Messages&lt;/h2&gt;');
  res.write('&lt;ol&gt;');
  for (i in messages) {
    res.write('&lt;li&gt;' + messages[i] + '&lt;/li&gt;');
  }
  res.write('&lt;/ol&gt;');
}

function writeForm(res) {
  res.write('&lt;form method="post"&gt;');
  res.write('&lt;input name="data"/&gt;&lt;input type="submit"/&gt;');
  res.write('&lt;/form&gt;');
}

function printEnv(res) {
  res.statusCode = 200;
  openHtml(res);
  for (entry in process.env) {
    res.write(entry + "=" + process.env[entry] + "&lt;br/&gt;");
  }
  closeHtml(res);
}

function unescapeFormData(msg) {
  return unescape(msg.replace('+', ' '));
}
</code></pre>

<p>Push the app to AppFog. For most prompts you can press <code>Enter</code> to accept the default value. At the Application Name prompt, enter a unique app name. Also, be sure to create and bind a rabbitmq service, as shown here:</p>

<pre><code>$ af push
    Would you like to deploy from the current directory? [Yn]:
    Application Name: rabbitmq-node
    Application Deployed URL [rabbitmq-node.aws.af.cm]:
    Detected a Node.js Application, is this correct? [Yn]:
    Memory Reservation (64M, 128M, 256M, 512M) [64M]:
    Creating Application: OK
    Would you like to bind any services to 'rabbitmq-node'? [yN]: y
    Would you like to use an existing provisioned service? [yN]: n
    The following system services are available
    1: mongodb
    2: mysql
    3: postgresql
    4: rabbitmq
    5: redis
    Please select one you wish to provision: 4
    Specify the name of the service [rabbitmq-6c981]:
    Creating Service: OK
    Binding Service [rabbitmq-6c981]: OK
    Uploading Application:
      Checking for available resources: OK
      Processing resources: OK
      Packing application: OK
      Uploading (1K): OK
    Push Status: OK
    Staging Application: OK
    Starting Application: OK
</code></pre>

<p>Access the app at the specified URL using your browser. Enter messages in the form and you’ll see them echoed in the browser.</p>


			</div>
		</div>
	</div>
</div>

				</div>

				<div class="span3 sidebar padding accordion" id="accordion2">
					<!--
					<div class="row border-bottom">
						<div class="span3">
							<form id="search-form" action="/search">
								<input type="search" placeholder="Search" id="search" name="q" size="30" />
								<input class="btn gray_blue search" type="submit" value="Go" />
							</form>
						</div>
					</div>-->
					<div class="accordion-group">
						<div class="row border-bottom accordion-heading">
							<div class="span3">
								<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseZero"><h6><i class="accordion-icon icon-chevron-right"></i> Getting Started</h6></a>
							</div>
						</div>
						
						<ul class="pages accordion-body collapse" id="collapseZero" style="height: 0;">
						
							<div class="accordion-inner">
								
								<li><a href="/getting-started/jumpstarts" >Jumpstarts</a></li>
								
								<li><a href="/getting-started/af-cli" >AF Command Line Tool</a></li>
								
							</div>
						</ul>
					</div>
					<div class="accordion-group">
						<div class="row border-bottom accordion-heading">
						<div class="span3">
								<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseTwo"><h6><i class="accordion-icon icon-chevron-right"></i> Frameworks</h6></a>
							</div>
						</div>
						
						<ul class="pages accordion-body collapse" id="collapseTwo" style="height: 0;">
						
							<div class="accordion-inner">
							
							<li><a href="/frameworks/java" >Java</a></li>
							
							<li><a href="/frameworks/node" >Node</a></li>
							
							<li><a href="/frameworks/php" >PHP</a></li>
							
							<li><a href="/frameworks/python" >Python</a></li>
							
							<li><a href="/frameworks/ruby" >Ruby</a></li>
							
							</div>
						</ul>
					</div>

					<div class="accordion-group">
						<div class="row border-bottom accordion-heading">
							<div class="span3">
								<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseThree"><h6><i class="accordion-icon icon-chevron-down"></i> Services</h6></a>
							</div>
						</div>
						
						<ul class="pages accordion-body collapse in" id="collapseThree" style="height: auto;">
						
							<div class="accordion-inner">
							
							<li><a href="/services/overview" >Overview</a></li>
							
							<li><a href="/services/tunneling" >Tunneling</a></li>
							
							<li><a href="/services/mysql" >MySQL</a></li>
							
							<li><a href="/services/mongodb" >MongoDB</a></li>
							
							<li><a href="/services/postgresql" >PostgreSQL</a></li>
							
							<li><a href="/services/redis" >Redis</a></li>
							
							<li><a href="/services/rabbitmq" class="on">RabbitMQ</a></li>
							
							</div>
						</ul>
					</div>

					<div class="accordion-group">
						<div class="row border-bottom accordion-heading">
							<div class="span3">
								<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseOne"><h6><i class="accordion-icon icon-chevron-right"></i> Customize</h6></a>
							</div>
						</div>
						
						<ul class="pages accordion-body collapse" id="collapseOne" style="height: 0;">
						
							<div class="accordion-inner">
								
								<li><a href="/customize/custom-domain-names" >Custom Domain Names</a></li>
								
								<li><a href="/customize/ssl" >SSL for Custom Domains</a></li>
								
								<li><a href="/customize/task-scheduling" >Task-scheduling</a></li>
								
							</div>
						</ul>
					</div>
					<div class="accordion-group">
						<div class="row border-bottom accordion-heading">
							<div class="span3">
								<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseFour"><h6><i class="accordion-icon icon-chevron-right"></i> Add-ons</h6></a>
							</div>
						</div>
						
						<ul class="pages accordion-body collapse" id="collapseFour" style="height: 0;">
						
							<div class="accordion-inner">
							
							<li><a href="/add-ons/searchify" >Searchify</a></li>
							
							<li><a href="/add-ons/mongolab" >MongoLab</a></li>
							
							<li><a href="/add-ons/mongohq" >MongoHQ</a></li>
							
							<li><a href="/add-ons/mailgun" >Mailgun</a></li>
							
							<li><a href="/add-ons/blitz" >Blitz</a></li>
							
							<li><a href="/add-ons/ironworker" >IronWorker</a></li>
							
							<li><a href="/add-ons/ironmq" >IronMQ</a></li>
							
							<li><a href="/add-ons/cloudmailin" >CloudMailin</a></li>
							
							<li><a href="/add-ons/cleardb" >ClearDB</a></li>
							
							<li><a href="/add-ons/memcachier" >MemCachier</a></li>
							
							<li><a href="/add-ons/statsmix" >StatsMix</a></li>
							
							<li><a href="/add-ons/nexmo" >Nexmo</a></li>
							
							<li><a href="/add-ons/cloudinary" >Cloudinary</a></li>
							
							<li><a href="/add-ons/partners" >Add-on Partnership</a></li>
							
							</div>
						</ul>
					</div>

						<div class="row border-bottom"><div class="span3"><a href="/faq" ><h6>FAQ</h6></div></a></div>
						<div class="row border-bottom"><div class="span3"><a href="http://console.appfog.com/pricing"><h6>Pricing</h6></a></div></div>
						<div class="row border-bottom"><div class="span3"><a href="/billing" ><h6>BILLING</h6></div></a></div>
						<div class="row border-bottom"><div class="span3"><a href="/troubleshooting" ><h6>Troubleshooting</h6></div></a></div>
						<!--<div class="row border-bottom"><div class="span3"><a href="/architecture" ><h6>Architecture</h6></div></a></div>-->
						<div class="row border-bottom"><div class="span3"><a href="/roadmap" ><h6>Feature Roadmap</h6></div></a></div>

					</div>
				</div>
			</div><!-- content -->
		</div><!-- container -->
	</div><!-- main_content -->

	<div id="footer">
		<div class="container">
			<div class="row">
				<div class="span1">
					<img src="http://appfog.com/img/bydevfordev_95.png" width="95" height="79" alt="By Developers For Developers" id="badge">
				</div>
				<div class="span3">
					<h4>About AppFog</h4>
					<p>Easily build and deploy fast, scalable, and reliable applications to the cloud in seconds. Yeah, it’s that easy.</p>					
				</div>
				<div class="span2">
					<h4>Info</h4>
					<ul>
						<li><a href="http://appfog.com/support/">Support</a></li>
						<li><a href="https://appfog.com/about/">About</a></li>
						<li><a href="http://dev.appfog.com/">Documentation</a></li>
					</ul>
				</div>
				<div class="span2 offsettop">
					<ul>
						<li>Phone: 1.888.974.7364</li>
						<li>&copy; <script>document.write(new Date().getFullYear());</script> AppFog.</li>
						<li>All Rights Reserved.</li>
					</ul>
				</div>
				<div class="span4">
					<h4>Social</h4>
					<ul id="social">
						<li id="facebook"><a href="http://www.facebook.com/pages/AppFog/159333004147490">Facebook</a></li>
						<li id="twitter"><a href="https://twitter.com/#!/appfog">Twitter</a></li>
						<li id="linkedin"><a href="http://www.linkedin.com/company/appfog">LinkedIn</a></li>
					</ul>
				</div>
			</div>
		</div> <!-- / .container -->
	</div>
	
	
<!-- scripts -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://appfog.com/js/libs/jquery-1.7.1.min.js"><\/script>')</script>
<script src="http://appfog.com/js/plugins.js"></script>
<script src="http://appfog.com/js/script.js"></script>
<script type="text/javascript" src="/js/docs.js"></script>

</body>
</html>
