<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>AppFog &mdash; Documentation Ruby</title> 

		<link rel="stylesheet" href="http://appfog.com/css/style.css">
		<link href="/css/prettify.css" type="text/css" rel="stylesheet" />
		<link href="/css/table.css" rel="stylesheet">
		<link href="/css/docs.css" rel="stylesheet">
		<!-- typekit -->
		<script type="text/javascript" src="http://use.typekit.com/abw3xjt.js"></script>
		<script type="text/javascript">try{Typekit.load();}catch(e){}</script>
				
		<!-- css -->

		<!-- modernizr -->
		<script src="http://appfog.com/js/libs/modernizr-2.5.3.min.js"></script>

		<script type="text/javascript" src="/js/google-code-prettify/prettify.js"></script>
		<script type="text/javascript" src="/js/jquery.js"></script>
		<script type="text/javascript" src="/js/bootstrap.js"></script>

		<!--  -->
		<link rel="icon" type="image/png" href="http://appfog.com/favicon.ico" />
		
		<script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-16856502-8']);
      _gaq.push(['_setDomainName', '.appfog.com']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
		
	</head>
	<body id="blog" onload="prettyPrint()">
	<div id="header">
		<div class="container">
			<a href="http://appfog.com/" id="app_fog"><img src="http://appfog.com/img/app-fog.png" width="189" height="47" alt="App Fog"></a>
			<ul id="main_nav">
				<li id="nproducts">
					<a href="#" title="Products" class="parent"><span>Products</span></a>
					<ul>
						<li><a href="http://appfog.com/products/appfog">AppFog</a></li>
						<li><a href="http://appfog.com/products/phpfog">PHP Fog</a></li>
					</ul>
				</li>
				<li id="npricing">
					<a href="#" title="Pricing" class="parent"><span>Pricing</span></a>
					<ul>
						<li><a href="https://console.appfog.com/pricing">AppFog</a></li>
						<li><a href="http://appfog.com/products/phpfog/pricing/">PhpFog</a></li>
					</ul>
				</li>
				<li id="nshowcase"><a href="http://appfog.com/showcase/" title="Showcase">Showcase</a></li>
				<li id="nabout"><a href="http://appfog.com/about/" title="About">About</a></li>
				<li id="nsupport"><a href="http://appfog.com/support/" title="Support">Support</a></li>
				<li id="nblog"><a href="http://blog.appfog.com/" title="Blog">Blog</a></li>

				<li id="nlogin">
						  <a href="#" title="Log In" class="btn gray">Log In <i class="icon-chevron-down"></i></a>
						  <form id="log_in_form" class="dropdown">
							<div class="container">
							  <!-- <div class="half">
								<div class="radio_btn" id="log_in_product_php_fog">
								  <span>
									<input type="radio" name="products" value="" id="log_in_php_fog" checked>
								  </span>
								  <label for="log_in_php_fog">Php Fog</label>
								</div>
							  </div>
							  <div class="half">
								<div class="radio_btn" id="log_in_product_appfog">
								  <span>
									<input type="radio" name="products" value="" id="log_in_appfog">
								  </span>
								  <label for="log_in_appfog">AppFog</label>
								</div>
								
							  </div>
							</div> -->
										
							<!-- <hr> -->

							<!-- <div class="container appfog">
							  <input type="email" name="email" value="" id="appfog_log_in_email" placeholder="Email" class="text">
							  <input type="password" name="password" value="" id="appfog_log_in_password" placeholder="Password" class="text">
							</div>
							
							<div class="container php_fog">
							  <input type="email" name="email" value="" id="php_fog_log_in_email" placeholder="Email" class="text">
							  <input type="password" name="password" value="" id="php_fog_log_in_password" placeholder="Password" class="text">
							</div> -->
										

										
							<!-- <div class="container">  
							  <div class="half">
								<div class="checkbox">
								  <span class="active">
									<input type="checkbox" name="remember_me" value="" id="log_in_remember_me" checked>
								  </span>
								</div>
								<label for="log_in_remember_me" class="remember_me">Remember Me</label>
							  </div>

							  <div class="half forgot_password">
								<a href="#">Forgot Password?</a>
							  </div>
							</div> -->
										<a href="https://phpfog.com/login" class="btn bright_green submit" style="font-size: 13px;">Log In to PHP Fog</a>
										<hr>
										<a href="https://console.appfog.com/login" class="btn bright_green submit" style="font-size: 13px;">Log In to AppFog</a>
									</form>
								</li>
								<li id="nsignup">
									<a href="#" title="Sign Up" class="btn bright_green">Sign Up <i class="icon-chevron-down"></i></a>
									<form id="sign_up_form" class="dropdown">
							<!-- <div class="container">
							  <div class="half">
								<div class="radio_btn" id="sign_up_product_php_fog">
								  <span>
									<input type="radio" name="products" value="" id="sign_up_php_fog" checked>
								  </span>
								  <label for="sign_up_php_fog">Php Fog</label>
								</div>
							  </div>
							  <div class="half">
								<div class="radio_btn" id="sign_up_product_appfog">
								  <span>
									<input type="radio" name="products" value="" id="sign_up_appfog">
								  </span>
								  <label for="sign_up_appfog">AppFog</label>
								</div>
								
							  </div>
							</div> -->
										
										<!-- <hr>
													
													<div class="container php_fog">
													  <input type="email" name="email" value="" id="sign_up_php_fog_email" placeholder="Email" class="text">
													  <input type="password" name="password" value="" id="sign_up_password" placeholder="Password" class="text">
													  <input type="password" name="password_confirmation" value="" id="sign_up_password_confirmation" placeholder="Password Confirmation" class="text">
													</div>
													
													<div class="container appfog">
													  <input type="email" name="email" value="" id="sign_up_appfog_email" placeholder="Email" class="text">
													</div> -->
										
										<a href="https://phpfog.com/signup" class="btn bright_green submit" style="font-size: 13px;">Register for PHP Fog</a>
										<hr>
										<a href="http://appfog.com/signup.php" class="btn bright_green submit" style="font-size: 13px;">Register for AppFog</a>
									</form>
								</li>

			</ul>
		</div> 
	</div>
	<div id="main_content">
		<div class='container'>

			
			<div id="top_bar" class="row gray_blue margin_bottom">
				<div class="span12">
					<a href="/"><h1 class="title">AppFog Docs</h1></a>
					<ul id="docs_nav">
						
						<li class="breadcrumb-separator">&raquo;</li>
						<li><a href="/frameworks">Frameworks</a></li>
						
						<li class="breadcrumb-separator">&raquo;</li>
						<li><a href="#">Ruby</a></li>
					</ul>
					<ul id="secondary_nav">
						<li><a href="http://docs.phpfog.com">PHP Fog Docs</a></li>
					</ul>
				</div>

			</div>
			
					


			<div id="content" class="row white">
				<div class="span8 main_content">
					<div class="row entries">
	<div class="span8">
		<div class="row">
			<div class="span8">
				<h1>Ruby</h1>
				<ul>
  <li><a href="#rubyversions">Supported Ruby Versions</a></li>
  <li><a href="#gems">Gems and Gemfiles</a></li>
  <li><a href="#bundler">Bundler</a></li>
  <li><a href="#rails23">Rails 2.3</a></li>
  <li><a href="#rails30">Rails 3.0</a></li>
  <li><a href="#rails31">Rails 3.1</a></li>
  <li><a href="#rake-db-seed">rake db:seed</a></li>
  <li><a href="#autoreconfig">Auto-reconfiguration</a></li>
  <li><a href="#sinatra">Sinatra</a></li>
</ul>

<h3 id="rubyversions">Supported Ruby Versions</h3>

<p>For a list of runtimes that AppFog supports run:</p>

<pre class="prettyprint"><code>$ af runtimes
</code></pre>

<p>Ruby 1.8.7 is the default Ruby runtime.</p>

<p>To use Ruby 1.9.3, for example, add the <code>af  --runtime ruby193</code> option when you push your code:</p>

<pre class="prettyprint"><code>$ af push &lt;appname&gt; --runtime ruby193
</code></pre>

<h1 id="gems">Gems and Gemfiles</h1>

<p>AppFog requires a <code>Gemfile</code> in your app’s root directory. This should list the gems your app needs to run. </p>

<p>The following Gemfile feature aren’t supported yet: </p>

<ul>
  <li>gem dependencies on git <code>URL</code>s or branches</li>
  <li>gem :path =&gt; “some/path”</li>
  <li>platform-conditional gems</li>
</ul>

<p>AppFog currently only offers one app server for Sinatra and Rails apps: Thin. If you’re using Bundler, and nothing in your app’s bundle requires Thin, VCAP cannot safely start your app using it. For Rails in such cases, it will fall back to running your app using ‘<code>rails server</code>’, which uses WEBrick. For best performance and results, use Thin.</p>

<h1 id="bundler">Bundler</h1>

<p>You should use <a href="http://gembundler.com/">Bundler</a> to package your apps. Run <code>bundle package; bundle install</code> each time you modify your Gemfile and before you make an <code>af push</code> or <code>af update</code> command.</p>

<h3 id="gems-with-known-issues">Gems with known issues:</h3>

<ul>
  <li>rmagick (requires http://www.imagemagick.org/script/index.php native library to be installed)</li>
  <li>libv8 (system-wide installation required)</li>
  <li>therubyracer (depency on libv8)</li>
</ul>

<p><a href="https://github.com/jbarnette/isolate">Isolate</a> is not well-supported on AppFog.</p>

<h1 id="rails23">Rails 2.3</h1>

<p>Rails’ ‘<code>config.gem</code>’ mechanism, which allows the user to specify a list of gems that the app needs to operate, is limited in that it cannot protect you from multi-deep dependencies (deeply layered gems using other gems). As mitigation, many Rails 2.3 apps have subsequently adopted Gem Bundler.</p>

<p>VCAP currently doesn’t detect Rails 2.3 apps. If you need to run a Ruby 2.3 app, disguise it as a Rails 3 app by creating a <code>config/application.rb</code> file and a ‘config.ru’.</p>

<h3 id="bundler">Bundler</h3>

<p>Rails 2.3 has its own gem handling system, but we can override that and use Bundler instead.</p>

<p>Insert the following code in <code>config/boot.rb</code>, right above <code>Rails.boot!</code>:</p>

<pre class="prettyprint linenums"><code>class Rails::Boot
    def run
        load_initializer

        Rails::Initializer.class_eval do
            def load_gems
                @bundler_loaded ||= Bundler.require :default, Rails.env
            end
        end

        Rails::Initializer.run(:set_load_path)
    end
end
</code></pre>

<p>Then create a new file called <code>config/preinitializer.rb</code> with the following:</p>

<pre class="prettyprint linenums"><code>begin
    require "rubygems"
    require "bundler"
rescue LoadError
    raise "Could not load the bundler gem. Install it with `gem install bundler`."
end

if Gem::Version.new(Bundler::VERSION) &lt;= Gem::Version.new("0.9.24")
    raise RuntimeError, "Your bundler version is too old for Rails 2.3." +
        "Run `gem install bundler` to upgrade."
end

begin
    # Set up load paths for all bundled gems
    ENV["BUNDLE_GEMFILE"] = File.expand_path("../../Gemfile", __FILE__)
    Bundler.setup
rescue Bundler::GemNotFound
    raise RuntimeError, "Bundler couldn't find some gems." +
        "Did you run `bundle install`?"
end
</code></pre>

<p>Get all <code>config.gem</code> declarations from your app and put them into the <code>Gemfile</code>. If you have declarations in <code>development.rb</code>, for example, place them in the named group. Make sure to include Rails itself and at least one source.</p>

<pre class="prettyprint linenums"><code>source 'http://rubygems.org'
gem "rails", "~&gt; 2.3.5"

# bundler requires these gems in all environments
# gem "nokogiri", "1.4.2"
# gem "geokit"

group :development do
	# bundler requires these gems in development
	# gem "rails-footnotes"
end

group :test do
	# bundler requires these gems while running tests
	# gem "rspec"
	# gem "faker"
end
</code></pre>

<p>For more details on Bundler support for Rails 2.3, check out <a href="http://gembundler.com/rails23.html">this guide</a>.</p>

<p>Watch out for complicated and confusing bundle settings. While VCAP does its best to handle your configuration, it’s possible to write Gemfiles that cannot be satisfied, for example by requesting an old version of Rails and a new version of Rack. These combinations will fail immediately; you won’t need to wait to push your app to the cloud to see it break. By the same token, Gemfiles and Gems that are too vague about versions can cause problems as well.</p>

<p>In Bundler groups, mixing multiple techniques for specifying which groups to load where (dev/test/prod) can sometimes cause problems.</p>

<p>When in doubt, be more specific when calling ‘<code>Bundler.setup</code>’. VCAP attempts to be as consistent as possible, but it’s possible to confuse the Bundler with badly behaved application bootstrap code.</p>

<p>The <code>bundle package</code> command will create a cache directory in your app and store local copies of the required gems, allowing you to run <code>bundle install</code> with the <code>--local</code> flag for faster load time. This will not work in our case as Bundler currently cannot package gems that need to be fetched from a git repository, and it doesn’t attempt to package gems that you have manually specified a path to using the <code>:path</code> Gemfile option. The best way to avoid this confusion is to stick to published gems.</p>

<p>Along with published gems, Gemfiles can refer to git repos by url, branch name, etc. and Bundler will build them using a specialized mechanism. VCAP currently has no support for these at all, and apps that need them will fail.</p>

<h1 id="rails30">Rails 3.0</h1>

<p>Ruby on Rails app deployments on AppFog automatically recognize MySQL. For other services, you’ll need to access the <code>VCAP_SERVICES</code> environment variable. More on that in our <a href="/services">Services doc</a>.</p>

<p>Make sure to use the correct version of the MySQL2 gem in your Gemfile:</p>

<pre class="prettyprint linenums"><code># If you use a different database in development, hide it from AppFog
group :development do
gem 'sqlite3'
end

# Rails 3.0 requires version less than 0.3 of mysql2 gem
group :production do
gem 'mysql2', '&lt; 0.3'
end
</code></pre>

<h3 id="bundle-your-app">Bundle your app:</h3>

<pre class="prettyprint"><code>$ bundle package
$ bundle install
</code></pre>

<p>Deploy:</p>

<pre class="prettyprint"><code>$ af push
</code></pre>

<h1 id="rails31">Rails 3.1</h1>

<p>Rails 3.1 introduces the asset pipeline. To get the asset pipeline working on AppFog, precompile your assets in your development environment. This compiles them into <code>public/assets</code>, at which point you can tweak the production environment configuration before excuting a normal <code>af push</code>.</p>

<h3 id="gemfile">Gemfile</h3>

<h4 id="ruby-18">Ruby 1.8</h4>

<pre class="prettyprint linenums"><code># If you use a different database in development, hide it from AppFog.
group :development do
gem 'sqlite3'
end

# Rails 3.1 can use the latest mysql2 gem.
group :production do
gem 'mysql2'
end
</code></pre>

<h4 id="ruby-19">Ruby 1.9</h4>

<pre class="prettyprint linenums"><code># If you use a different database in development, hide it from AppFog.
group :development do
gem 'sqlite3'
end

# Rails 3.1 can use the latest mysql2 gem.
group :production do
gem 'mysql2'
end

# For Ruby 1.9 AppFog requires a tweak to the jquery-rails gem.
# gem 'jquery-rails'
gem 'cloudfoundry-jquery-rails'

# For Ruby 1.9 AppFog requires a tweak to devise.
# Uncomment next line if you plan to use devise.
# gem 'cloudfoundry-devise', :require =&gt; 'devise'
</code></pre>

<h3 id="bundle-your-app-1">Bundle your app:</h3>

<pre class="prettyprint"><code>$ bundle package
$ bundle install
</code></pre>

<h3 id="configs">Configs</h3>

<p>In <code>config/environments/production.rb</code>, change</p>

<pre class="prettyprint"><code>config.serve_static_assets = false
</code></pre>

<p>to</p>

<pre class="prettyprint"><code>config.serve_static_assets = true
</code></pre>

<h3 id="assets">Assets</h3>

<p>Pre-compile your asset pipeline:</p>

<pre class="prettyprint"><code>$ bundle exec rake assets:precompile
</code></pre>

<h3 id="version-control-system">Version Control System</h3>

<p>Commit the current configuration to your version control system. Consider including: + <code>Gemfile.lock</code> + gems packaged into <code>vendor/cache</code> + assets compiled into <code>public/assets</code>.</p>

<h3 id="deploy">Deploy</h3>

<pre class="prettyprint"><code>$ af push
</code></pre>

<h1 id="services">Services</h1>

<p>AppFog automatically creates and binds a new MySQL service with the Ruby on Rails jumpstart, and the app is <a href="#autoreconfig">automatically reconfigured</a> to connect to the service. For more information on services and how to connect to them manually, check out our docs on <a href="/services/overview">Services</a>.</p>

<h1 id="rake-db-seed">rake db:seed</h1>

<p>This assumes that you have your Rails app set up, and you have a MySQL service bound to it.</p>

<h3 id="tunnel-to-your-bound-mysql-service">Tunnel to your bound MySQL service</h3>

<p>Use the <a href="/services/tunneling">af tunnel</a> command to connect to the MySQL service that’s bound to your Rails app. When prompted, enter ‘1’ for no client.</p>

<pre class="prettyprint"><code>$ af tunnel 
1: rails-mysql-example 
Which service to tunnel to?: 1
Getting tunnel connection info: OK

Service connection info: 
username : &lt;username&gt; 
password : &lt;password&gt; 
name : &lt;db-name&gt;

Starting tunnel to rails-mysql-example on port 10000. 
1: none 
2: mysql 
3: mysqldump 
Which client would you like to start?: 1 
Open another shell to run command-line clients or 
use a UI tool to connect using the displayed information. 
Press Ctrl-C to exit...
</code></pre>

<p>You now have a secure tunnel set up to your MySQL service through which you can run <code>rake db:seed</code>.</p>

<h3 id="create-a-new-section-in-your-configdatabaseyml-file">Create a new section in your <code>config/database.yml</code> file</h3>

<pre class="prettyprint"><code>proxied-appfog: 
adapter: mysql2 
database: &lt;db-name&gt; 
username: &lt;username&gt; 
password: &lt;password&gt; 
port: 10000 
host: 127.0.0.1
</code></pre>

<h3 id="run-rake-dbseed">Run <code>rake db:seed</code></h3>

<p>Start with a simple <code>seeds.rb</code> file that just creates one record in your database to test that it works. </p>

<p>Then, leaving open the terminal window with the tunnel running in it, open a new terminal window and run:</p>

<pre class="prettyprint"><code>$ RAILS_ENV=proxied-appfog rake db:seed
</code></pre>

<p>If all goes well, you should have a log file in your <code>log/</code> directory called <code>proxied-appfog.log</code> that shows the SQL commands running from your <code>seeds.rb</code> file. </p>

<pre class="prettyprint"><code>$ af files ror-example logs/
startup.log                               8.2K
stdout.log                                  0B
proxied-appfog.log                          0B
</code></pre>

<h1 id="autoreconfig">Auto-reconfiguration</h1>

<p>Ruby on Rails apps deployed on AppFog support auto-reconfiguration for relational database services. This means you can deploy a Rails app on AppFog without changing a single line of code. </p>

<p>Note: Auto-reconfiguration is currently disabled by default. To enable, add a <code>config/cloudfoundry.yml</code> file containing the following:</p>

<pre class="prettyprint"><code>---
autoconfig: true
</code></pre>

<p>AppFog automatically reconfigures Rails apps by modifying the production settings in your <code>config/database.yml</code> file during staging.</p>

<p>While it’s fairly common to put these types of connections in a Rails Initializer File, auto-reconfiguration should work just as well if you create the connection somewhere else within your app.</p>

<p>When your Rails app is staged for deployment, AppFog makes two modifications:</p>

<ul>
  <li>Adds an additional <code>cf-autoconfig</code> gem to your Bundle.</li>
  <li>Adds an Initializer file to <code>config/initializers</code> that ensures that all dynamic class modification is done prior to loading other Initializers (and thus before your app executes).</li>
</ul>

<h3 id="limitations">Limitations</h3>

<p>Auto-reconfiguration only works if there’s exactly one service of a given service type bound to your app. For example, you can only bind only one relational database service (e.g. MySQL or Postgres) to an app. </p>

<p>If your app doesn’t follow these limitations, AppFog won’t auto-reconfigure your app. </p>

<p>The auto-reconfiguration mechanism also expects typical Ruby apps. If your app configuration is complex, it may not work. In those cases, you can opt out of auto-reconfiguration:</p>

<!---

### Opting out of auto-reconfiguration

AppFog offers a few ways to opt out of the auto-reconfiguration mechanism.

* Create a file in your Rails app called `config/cloudfoundry.yml`. Add the entry `autoconfig: false`.
* Include the `cf-runtime` gem in your app's `Gemfile`. --->

<h3 id="further-reading">Further Reading</h3>

<p>For more technical details about how auto-reconfiguration works on AppFog, check out <a href="http://blog.cloudfoundry.com/2012/03/12/using-cloud-foundry-services-with-ruby-part-1-auto-reconfiguration/">this blog post</a>.</p>

<h1 id="sinatra">Sinatra</h1>

<p>To use AppFog services with Sinatra, you have to access the <code>VCAP_SERVICES</code> environment variable. You can read more about this on the <a href="/services/overview">Services Overview page</a>.</p>

<p>AppFog autodetects your Sintra app by searching for <code>require 'sinatra'</code> in the <code>*.rb</code> files. It then chooses that file as the main Sinatra app file. </p>

<p>If you use Bundler to load Sinatra, AppFog may not recognize your app. In this case, you can simply manually tell AppFog that it’s a Sinatra app when you push your code: </p>

<pre class="prettyprint"><code>$ af push
Would you like to deploy from the current directory? [Yn]:
Application Name: sinatra-example
Detected a Standalone Application, is this correct? [Yn]: n
1: Rails
2: Spring
3: Grails
4: Lift
5: JavaWeb
6: Standalone
7: Sinatra
8: Node
9: PHP
10: Erlang/OTP Rebar
11: WSGI
12: Django
13: Rack
Select Application Type: 7
Selected Sinatra Application
...
</code></pre>

<!--- You can put a comment in your app’s main file like this:

{: .prettyprint .linenums}
    # require 'sinatra'   # required for framework detection in AppFog...
    require 'rubygems'
    require 'bundler'
    Bundler.require
    ...
--->

<h1 id="sample-sinatra-app-using-datamapper-and-bundler">Sample Sinatra App Using DataMapper and Bundler</h1>

<h4 id="gemfile-1">Gemfile</h4>

<pre class="prettyprint linenums"><code>source 'http://rubygems.org'

gem 'sinatra'
gem 'data_mapper'

group :development do
    gem 'dm-sqlite-adapter'
end

group :production do
    gem 'dm-mysql-adapter'
end
</code></pre>

<h4 id="sinatradmrb"><code>sinatra_dm.rb</code></h4>

<p>The name of this sinatra app will be <code>sinatra_dm.rb</code>.</p>

<!--- Note the commented out require of sinatra, which is necessary for proper detection of the app’s main file. --->

<!---    # require 'sinatra'   # required for framework detection in AppFog. --->

<pre class="prettyprint linenums"><code># Sample Sinatra app with DataMapper
# Based on http://sinatra-book.gittr.com/ DataMapper example
require 'rubygems'
require 'bundler'
Bundler.require

if ENV['VCAP_SERVICES'].nil?
    DataMapper::setup(:default, "sqlite3://#{Dir.pwd}/blog.db")
else
    require 'json'
    svcs = JSON.parse ENV['VCAP_SERVICES']
    mysql = svcs.detect { |k,v| k =~ /^mysql/ }.last.first
    creds = mysql['credentials']
    user, pass, host, name = %w(user password host name).map { |key| creds[key] }
    DataMapper.setup(:default, "mysql://#{user}:#{pass}@#{host}/#{name}")
end

class Post
    include DataMapper::Resource
    property :id, Serial
    property :title, String
    property :body, Text
    property :created_at, DateTime
end

DataMapper.finalize
Post.auto_upgrade!

get '/' do
    @posts = Post.all(:order =&gt; [:id.desc], :limit =&gt; 20)
    erb :index
end

get '/post/new' do
    erb :new
end

get '/post/:id' do
    @post = Post.get(params[:id])
    erb :post
end

post '/post/create' do
    post = Post.new(:title =&gt; params[:title], :body =&gt; params[:body])
    if post.save
        status 201
        redirect "/post/#{post.id}"
    else
        status 412
        redirect '/'
    end
end
</code></pre>

<h3 id="views">Views</h3>

<h4 id="index">Index</h4>

<pre class="prettyprint linenums"><code>&lt;!-- views/index.erb --&gt;

&lt;h1&gt;All Blog Posts&lt;/h1&gt;
&lt;ul&gt;
    &lt;% @posts.each do |post| %&gt;
        &lt;li&gt;&lt;a href="/post/&lt;%= post.id %&gt;"&gt;&lt;%= post.title %&gt;&lt;/a&gt;&lt;/li&gt;
    &lt;% end %&gt;
&lt;/ul&gt;
&lt;br /&gt;
&lt;a href="/post/new"&gt;Create new post&lt;/a&gt;
</code></pre>

<h4 id="new">New</h4>

<pre class="prettyprint linenums"><code>&lt;!-- views/new.erb --&gt;

&lt;h1&gt;Create a new blog post&lt;/h1&gt;
&lt;form action="/post/create" method="POST"&gt;
    &lt;p&gt;Title: &lt;input type="text" name="title"&gt;&lt;/input&gt;&lt;/p&gt;
    &lt;p&gt;Text: &lt;textarea name="body" rows="10" cols="40"&gt;&lt;/textarea&gt;&lt;/p&gt;
    &lt;input type="submit" name="Publish" /&gt;
&lt;/form&gt;
</code></pre>

<h4 id="post">Post</h4>

<pre class="prettyprint linenums"><code>&lt;!-- views/post.erb --&gt;

&lt;h1&gt;&lt;%= @post.title %&gt;&lt;/h1&gt;
&lt;p&gt;&lt;%= @post.body %&gt;&lt;/p&gt;
&lt;a href="/"&gt;All Posts&lt;/a&gt;
</code></pre>

<h3 id="test-locally">Test Locally</h3>

<pre class="prettyprint"><code>$ ruby sinatra_dm.rb
</code></pre>

<p>Then visit <a href="http://localhost:4567/">http://localhost:4567/</a> in your browser.</p>

<h3 id="bundle-and-push">Bundle and Push</h3>

<pre class="prettyprint linenums"><code>$ bundle install; bundle package
$ af push
</code></pre>


			</div>
		</div>
	</div>
</div>

				</div>

				<div class="span3 sidebar padding accordion" id="accordion2">
					<!--
					<div class="row border-bottom">
						<div class="span3">
							<form id="search-form" action="/search">
								<input type="search" placeholder="Search" id="search" name="q" size="30" />
								<input class="btn gray_blue search" type="submit" value="Go" />
							</form>
						</div>
					</div>-->
					<div class="accordion-group">
						<div class="row border-bottom accordion-heading">
							<div class="span3">
								<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseOne"><h6><i class="accordion-icon icon-chevron-right"></i> Getting Started</h6></a>
							</div>
						</div>
						
						<ul class="pages accordion-body collapse" id="collapseOne" style="height: 0;">
						
							<div class="accordion-inner">
								
								<li><a href="/getting-started/jumpstarts" >Jumpstarts</a></li>
								
								<li><a href="/getting-started/af-cli" >AF Command Line Tool</a></li>
								
							</div>
						</ul>
					</div>
					<div class="accordion-group">
						<div class="row border-bottom accordion-heading">
						<div class="span3">
								<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseTwo"><h6><i class="accordion-icon icon-chevron-down"></i> Frameworks</h6></a>
							</div>
						</div>
						
						<ul class="pages accordion-body collapse in" id="collapseTwo" style="height: auto;">
						
							<div class="accordion-inner">
							
							<li><a href="/frameworks/java" >Java</a></li>
							
							<li><a href="/frameworks/node" >Node</a></li>
							
							<li><a href="/frameworks/php" >PHP</a></li>
							
							<li><a href="/frameworks/python" >Python</a></li>
							
							<li><a href="/frameworks/ruby" class="on">Ruby</a></li>
							
							</div>
						</ul>
					</div>

					<div class="accordion-group">
						<div class="row border-bottom accordion-heading">
							<div class="span3">
								<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseThree"><h6><i class="accordion-icon icon-chevron-right"></i> Services</h6></a>
							</div>
						</div>
						
						<ul class="pages accordion-body collapse" id="collapseThree" style="height: 0;">
						
							<div class="accordion-inner">
							
							<li><a href="/services/overview" >Overview</a></li>
							
							<li><a href="/services/tunneling" >Tunneling</a></li>
							
							<li><a href="/services/mysql" >MySQL</a></li>
							
							<li><a href="/services/mongodb" >MongoDB</a></li>
							
							<li><a href="/services/postgresql" >PostgreSQL</a></li>
							
							</div>
						</ul>
					</div>

					<div class="accordion-group">
						<div class="row border-bottom accordion-heading">
							<div class="span3">
								<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseFour"><h6><i class="accordion-icon icon-chevron-right"></i> Add-ons</h6></a>
							</div>
						</div>
						
						<ul class="pages accordion-body collapse" id="collapseFour" style="height: 0;">
						
							<div class="accordion-inner">
							
							<li><a href="/add-ons/searchify" >Searchify</a></li>
							
							<li><a href="/add-ons/mongolab" >MongoLab</a></li>
							
							<li><a href="/add-ons/mongohq" >MongoHQ</a></li>
							
							<li><a href="/add-ons/mailgun" >Mailgun</a></li>
							
							<li><a href="/add-ons/blitz" >Blitz</a></li>
							
							<li><a href="/add-ons/ironworker" >IronWorker</a></li>
							
							<li><a href="/add-ons/ironmq" >IronMQ</a></li>
							
							<li><a href="/add-ons/cloudmailin" >CloudMailin</a></li>
							
							<li><a href="/add-ons/cleardb" >ClearDB</a></li>
							
							<li><a href="/add-ons/partners" >Add-on Partnership</a></li>
							
							</div>
						</ul>
					</div>

						<div class="row border-bottom"><div class="span3"><a href="/faq" ><h6>FAQ</h6></div></a></div>
						<div class="row border-bottom"><div class="span3"><a href="http://console.appfog.com/pricing"><h6>Pricing</h6></a></div></div>
						<div class="row border-bottom"><div class="span3"><a href="/billing" ><h6>BILLING</h6></div></a></div>
						<div class="row border-bottom"><div class="span3"><a href="/troubleshooting" ><h6>Troubleshooting</h6></div></a></div>
						<!--<div class="row border-bottom"><div class="span3"><a href="/architecture" ><h6>Architecture</h6></div></a></div>-->
						<div class="row border-bottom"><div class="span3"><a href="/roadmap" ><h6>Feature Roadmap</h6></div></a></div>

					</div>
				</div>
			</div><!-- content -->
		</div><!-- container -->
	</div><!-- main_content -->

	<div id="footer">
		<div class="container">
			<div class="row">
				<div class="span1">
					<img src="http://appfog.com/img/bydevfordev_95.png" width="95" height="79" alt="By Developers For Developers" id="badge">
				</div>
				<div class="span3">
					<h4>About AppFog</h4>
					<p>Easily build and deploy fast, scalable, and reliable applications to the cloud in seconds. Yeah, it’s that easy.</p>					
				</div>
				<div class="span2">
					<h4>Info</h4>
					<ul>
						<li><a href="http://appfog.com/support/">Support</a></li>
						<li><a href="https://appfog.com/about/">About</a></li>
						<li><a href="http://dev.appfog.com/">Documentation</a></li>
					</ul>
				</div>
				<div class="span2 offsettop">
					<ul>
						<li>Phone: 1.888.974.7364</li>
						<li>&copy; <script>document.write(new Date().getFullYear());</script> AppFog.</li>
						<li>All Rights Reserved.</li>
					</ul>
				</div>
				<div class="span4">
					<h4>Social</h4>
					<ul id="social">
						<li id="facebook"><a href="http://www.facebook.com/pages/AppFog/159333004147490">Facebook</a></li>
						<li id="twitter"><a href="https://twitter.com/#!/appfog">Twitter</a></li>
						<li id="linkedin"><a href="http://www.linkedin.com/company/appfog">LinkedIn</a></li>
					</ul>
				</div>
			</div>
		</div> <!-- / .container -->
	</div>
	
	
<!-- scripts -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://appfog.com/js/libs/jquery-1.7.1.min.js"><\/script>')</script>
<script src="http://appfog.com/js/plugins.js"></script>
<script src="http://appfog.com/js/script.js"></script>
<script type="text/javascript" src="/js/docs.js"></script>

</body>
</html>
