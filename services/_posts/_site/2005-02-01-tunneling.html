<p>You can interact with your provisioned services interactively by using the <code>af tunnel</code> command. This uses an app called &#8220;Caldecott&#8221;, which is a <code>TCP</code> proxy over <code>HTTPS</code>. Caldecott creates a tunnel that connects a port on your local computer to the service in AppFog. The <code>af tunnel</code> command uploads the Caldecott app to your AppFog instance, sets up the tunneling, and offers to start a standard client on your computer to work with the service. This can be useful for managing your services as well as for debugging.</p>

<h3 id='prereqs'>Prerequisites</h3>

<ul>
<li>Caldecott requires Ruby 1.9.2.</li>

<li>Caldecott starts a client program for the service you want to access, for example <code>mysql</code> for <code>MySQL</code> or <code>psql</code> for <code>PostgreSQL</code>. The client must be installed on your computer and be on the execution <code>PATH</code> so that Caldecott scripts can start it. If you want to use a different client, Caldecott will display the connection information and credentials you will need to connect to the service. The following table shows the client programs Caldecott can start for each service.</li>
</ul>
<table class='table table-bordered table-striped'>

<tr>
<th>Service</th>
<th>Client</th>
</tr>

<tr>
<td>MongoDB</td>
<td><tt>mongo</tt></td>
</tr>

<tr>
<td>MySQL</td>
<td><tt>mysql</tt></td>
</tr>

<tr>
<td>PostgreSQL</td>
<td><tt>psql</tt></td>
</tr>

<!---
<tr>
<td>rabbitmq</td>
<td><i>none</i></td>
</tr>

<tr>
<td>Redis</td>
<td><tt>redis-cli</tt></td>
</tr>
--->

</table>
<h3 id='tunneling'>Tunneling</h3>

<p>Get a list of your services by using the <code>af services</code> command:</p>

<pre class='prettyprint'><code>$ af services</code></pre>

<p>Which should return something like this:</p>

<pre class='prettyprint'><code>============== System Services ==============

+------------+---------+-----------------------------+
| Service    | Version | Description                 |
+------------+---------+-----------------------------+
| mongodb    | 1.8     | MongoDB NoSQL store         |
| mysql      | 5.1     | MySQL database service      |
| postgresql | 9.1     | PostgreSQL database service |
+------------+---------+-----------------------------+

=========== Provisioned Services ============

+-----------------------+------------+
| Name                  | Service    |
+-----------------------+------------+
| exampleapp1-mysql     | mysql      |
| exampleapp2-mysql     | mysql      |
| exampleappmongodb     | mongodb    |
| example-postgres      | postgresql |
+-----------------------+------------+</code></pre>

<p>Create a tunnel to the service with <code>af tunnel &lt;service&gt;</code>. For example:</p>

<pre class='prettyprint'><code>$ af tunnel exampleapp1-mysql</code></pre>

<p>The first time you create a tunnel, <code>af</code> uploads Caldecott to your Cloud:</p>

<pre class='prettyprint'><code>Uploading Application:
Checking for available resources: OK
Processing resources: OK
Packing application: OK
Uploading (1K): OK
Push Status: OK
Binding Service [exampleapp1-mysql]: OK
Staging Application: OK
Starting Application: OK</code></pre>

<p>Then Caldecott creates the tunnel and prompts you to start a client. Here&#8217;s an example session with <code>mysql</code>.</p>

<pre class='prettyprint'><code>Starting tunnel to exampleapp1-mysql on port 10000.
1: none
2: mysql
3: mysqldump
Which client would you like to start?: 2
Launching &#39;mysql --protocol=TCP --host=localhost --port=10000
--user=um4rwWyhwa07B --password=pBiBlqjINB6cmdd368741dbc1945cfb62315565efcf1b5&#39;

Welcome to the MySQL monitor.  Commands end with ; or \g.
Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.
.
.
.
mysql&gt;</code></pre>

<p>When you exit the client, <code>af</code> disconnects the tunnel.</p>

<p>If you choose the <code>1: none</code> or if Caldecott doesn&#8217;t have a default client for the service, you can simply leave the terminal window open. You can then start your preferred client in another window. Once you&#8217;re done, hit <code>Ctrl-C</code> to exit <code>af</code> and close the tunnel.</p>

<h3 id='more_about_the_tunnel_command'>More about the Tunnel Command</h3>

<p>You can simply enter the <code>af tunnel</code> command and respond to the prompts to create a tunnel. The command allows you to select from a list of existing provisioned services, so you don&#8217;t need to know the service&#8217;s name ahead of time.</p>

<p>The full syntax of the <code>af tunnel</code> command is:</p>

<pre class='prettyprint'><code>af tunnel [&lt;servicename&gt;] [--port &lt;portnumber&gt;] [&lt;clientcmd&gt;]</code></pre>

<p>The <code>&lt;servicename&gt;</code> argument is the name of the service, as shown by the <code>af services</code> command. If you exclude <code>&lt;servicename&gt;</code>, <code>af</code> provides a list of existing services to choose from.</p>

<p>The <code>&lt;portnumber&gt;</code> parameter is the port to use on the local machine. By default, <code>af</code> chooses an available port in the <code>10000</code> range.</p>

<p>The <code>&lt;clientcmd&gt;</code> argument is the name of the client program to start. Only the client names shown in the table in the <a href='#prereqs'>Prerequisites</a> section are supported for this argument.</p>

<h3 id='links'>Links</h3>

<p>For more information, check out <a href='http://blog.cloudfoundry.com/2011/11/17/now-you-can-tunnel-into-any-cloud-foundry-data-service/'>this blog post</a> and <a href='http://docs.cloudfoundry.com/tools/vmc/caldecott.html'>this doc</a> from Cloud Foundry. You can also check out <a href='https://github.com/cloudfoundry/caldecott'>Caldecott&#8217;s GitHub repository</a>.</p>